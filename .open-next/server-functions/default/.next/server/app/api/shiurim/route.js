(()=>{var e={};e.id=411,e.ids=[411],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},8469:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>q,serverHooks:()=>D,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>y});var a={};r.r(a),r.d(a,{GET:()=>f,POST:()=>w});var n=r(2706),s=r(8203),i=r(5994),u=r(9187),o=r(2545),l=r(6980),d=r(4512),p=r(7579),c=r(2489);async function m(e){let t=(await (0,d.UL)()).get("admin-session");if(!t)return!1;let r=(0,o.Lf)(e);return!!await r.select().from(l.users).where((0,p.eq)(l.users.id,t.value)).get()}async function f(e){try{let e=await (0,o.x8)();if(!e)return u.NextResponse.json({error:"Database not configured"},{status:500});let t=(0,o.Lf)(e),r=await t.select().from(l.shiurim).orderBy((0,c.i)(l.shiurim.pubDate)).all(),a=await Promise.all(r.map(async e=>{let r=await t.select().from(l.platformLinks).where((0,p.eq)(l.platformLinks.shiurId,e.id)).get();return{...e,platformLinks:r||null}}));return u.NextResponse.json(a)}catch(e){return console.error("Error fetching shiurim:",e),u.NextResponse.json({error:"Internal server error"},{status:500})}}async function w(e){try{let t=await (0,o.x8)();if(!t)return u.NextResponse.json({error:"Database not configured"},{status:500});if(!await m(t))return u.NextResponse.json({error:"Unauthorized"},{status:401});let r=await e.json(),a=(0,o.Lf)(t),n=await a.insert(l.shiurim).values({guid:r.guid,title:r.title,description:r.description,blurb:r.blurb,audioUrl:r.audioUrl,sourceDoc:r.sourceDoc,pubDate:new Date(r.pubDate),duration:r.duration,link:r.link}).returning().get(),s=null;return r.platformLinks&&(s=await a.insert(l.platformLinks).values({shiurId:n.id,...r.platformLinks}).returning().get()),u.NextResponse.json({...n,platformLinks:s})}catch(e){return console.error("Error creating shiur:",e),u.NextResponse.json({error:"Internal server error"},{status:500})}}let q=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/shiurim/route",pathname:"/api/shiurim",filename:"route",bundlePath:"app/api/shiurim/route"},resolvedPagePath:"C:\\Users\\alk77\\Downloads\\krazywaz-master\\krazywaz-master\\Downloads\\krazywaz\\krazzzzz\\app\\api\\shiurim\\route.ts",nextConfigOutput:"standalone",userland:a}),{workAsyncStorage:h,workUnitAsyncStorage:y,serverHooks:D}=q;function x(){return(0,i.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:y})}},6487:()=>{},8335:()=>{},2545:(e,t,r)=>{"use strict";r.d(t,{Lf:()=>s,x8:()=>i});var a=r(1205),n=r(6980);function s(e){return(0,a.f)(e,{schema:n})}async function i(){try{let{getCloudflareContext:e}=await r.e(535).then(r.bind(r,6535)),t=await e(),a=t?.env;if(a?.DB)return a.DB}catch(e){}return globalThis.DB?globalThis.DB:null}},6980:(e,t,r)=>{"use strict";r.r(t),r.d(t,{platformLinks:()=>o,shiurim:()=>u,users:()=>i});var a=r(3137),n=r(3161),s=r(7095);let i=(0,a.D)("users",{id:(0,n.Qq)("id").primaryKey().$defaultFn(()=>crypto.randomUUID()),email:(0,n.Qq)("email").notNull().unique(),password:(0,n.Qq)("password").notNull(),name:(0,n.Qq)("name"),createdAt:(0,s.nd)("created_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date),updatedAt:(0,s.nd)("updated_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date).$onUpdate(()=>new Date)}),u=(0,a.D)("shiurim",{id:(0,n.Qq)("id").primaryKey().$defaultFn(()=>crypto.randomUUID()),guid:(0,n.Qq)("guid").notNull().unique(),slug:(0,n.Qq)("slug").unique(),title:(0,n.Qq)("title").notNull(),description:(0,n.Qq)("description"),blurb:(0,n.Qq)("blurb"),audioUrl:(0,n.Qq)("audio_url").notNull(),sourceDoc:(0,n.Qq)("source_doc"),pubDate:(0,s.nd)("pub_date",{mode:"timestamp"}).notNull(),duration:(0,n.Qq)("duration"),link:(0,n.Qq)("link"),thumbnail:(0,n.Qq)("thumbnail"),createdAt:(0,s.nd)("created_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date),updatedAt:(0,s.nd)("updated_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date).$onUpdate(()=>new Date)}),o=(0,a.D)("platform_links",{id:(0,n.Qq)("id").primaryKey().$defaultFn(()=>crypto.randomUUID()),shiurId:(0,n.Qq)("shiur_id").notNull().unique().references(()=>u.id,{onDelete:"cascade"}),youtube:(0,n.Qq)("youtube"),youtubeMusic:(0,n.Qq)("youtube_music"),spotify:(0,n.Qq)("spotify"),apple:(0,n.Qq)("apple"),amazon:(0,n.Qq)("amazon"),pocket:(0,n.Qq)("pocket"),twentyFourSix:(0,n.Qq)("twenty_four_six"),castbox:(0,n.Qq)("castbox"),createdAt:(0,s.nd)("created_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date),updatedAt:(0,s.nd)("updated_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date).$onUpdate(()=>new Date)})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,920,452,512],()=>r(8469));module.exports=a})();