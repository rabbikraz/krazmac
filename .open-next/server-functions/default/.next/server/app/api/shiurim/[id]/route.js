(()=>{var e={};e.id=999,e.ids=[999],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},5414:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>k,routeModule:()=>h,serverHooks:()=>D,workAsyncStorage:()=>q,workUnitAsyncStorage:()=>x});var a={};r.r(a),r.d(a,{DELETE:()=>w,GET:()=>m,PUT:()=>f});var n=r(2706),s=r(8203),i=r(5994),o=r(9187),u=r(2545),d=r(6980),l=r(4512),p=r(7579);async function c(e){let t=(await (0,l.UL)()).get("admin-session");if(!t)return!1;let r=(0,u.Lf)(e);return!!await r.select().from(d.users).where((0,p.eq)(d.users.id,t.value)).get()}async function m(e,{params:t}){try{let{id:e}=await t,r=await (0,u.x8)();if(!r)return o.NextResponse.json({error:"Database not configured"},{status:500});let a=(0,u.Lf)(r),n=await a.select().from(d.shiurim).where((0,p.eq)(d.shiurim.id,e)).get();if(!n)return o.NextResponse.json({error:"Shiur not found"},{status:404});let s=await a.select().from(d.platformLinks).where((0,p.eq)(d.platformLinks.shiurId,e)).get();return o.NextResponse.json({...n,platformLinks:s||null})}catch(e){return console.error("Error fetching shiur:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}async function f(e,{params:t}){try{let{id:r}=await t,a=await (0,u.x8)();if(!a)return o.NextResponse.json({error:"Database not configured"},{status:500});if(!await c(a))return o.NextResponse.json({error:"Unauthorized"},{status:401});let n=await e.json(),s=(0,u.Lf)(a),i={};void 0!==n.title&&(i.title=n.title),void 0!==n.slug&&(i.slug=n.slug||null),void 0!==n.description&&(i.description=n.description),void 0!==n.blurb&&(i.blurb=n.blurb),void 0!==n.audioUrl&&(i.audioUrl=n.audioUrl),void 0!==n.sourceDoc&&(i.sourceDoc=n.sourceDoc),void 0!==n.pubDate&&(i.pubDate=new Date(n.pubDate)),void 0!==n.duration&&(i.duration=n.duration),void 0!==n.link&&(i.link=n.link),void 0!==n.thumbnail&&(i.thumbnail=n.thumbnail||null),i.updatedAt=new Date;let l=await s.update(d.shiurim).set(i).where((0,p.eq)(d.shiurim.id,r)).returning().get();n.platformLinks&&(await s.select().from(d.platformLinks).where((0,p.eq)(d.platformLinks.shiurId,r)).get()?await s.update(d.platformLinks).set({...n.platformLinks,updatedAt:new Date}).where((0,p.eq)(d.platformLinks.shiurId,r)).execute():await s.insert(d.platformLinks).values({shiurId:r,...n.platformLinks}).execute());let m=await s.select().from(d.platformLinks).where((0,p.eq)(d.platformLinks.shiurId,r)).get();return o.NextResponse.json({...l,platformLinks:m||null})}catch(e){return console.error("Error updating shiur:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}async function w(e,{params:t}){try{let{id:e}=await t,r=await (0,u.x8)();if(!r)return o.NextResponse.json({error:"Database not configured"},{status:500});if(!await c(r))return o.NextResponse.json({error:"Unauthorized"},{status:401});let a=(0,u.Lf)(r);return await a.delete(d.shiurim).where((0,p.eq)(d.shiurim.id,e)).execute(),o.NextResponse.json({success:!0})}catch(e){return console.error("Error deleting shiur:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/shiurim/[id]/route",pathname:"/api/shiurim/[id]",filename:"route",bundlePath:"app/api/shiurim/[id]/route"},resolvedPagePath:"C:\\Users\\alk77\\Downloads\\krazywaz-master\\krazywaz-master\\Downloads\\krazywaz\\krazzzzz\\app\\api\\shiurim\\[id]\\route.ts",nextConfigOutput:"standalone",userland:a}),{workAsyncStorage:q,workUnitAsyncStorage:x,serverHooks:D}=h;function k(){return(0,i.patchFetch)({workAsyncStorage:q,workUnitAsyncStorage:x})}},6487:()=>{},8335:()=>{},2545:(e,t,r)=>{"use strict";r.d(t,{Lf:()=>s,x8:()=>i});var a=r(1205),n=r(6980);function s(e){return(0,a.f)(e,{schema:n})}async function i(){try{let{getCloudflareContext:e}=await r.e(535).then(r.bind(r,6535)),t=await e(),a=t?.env;if(a?.DB)return a.DB}catch(e){}return globalThis.DB?globalThis.DB:null}},6980:(e,t,r)=>{"use strict";r.r(t),r.d(t,{platformLinks:()=>u,shiurim:()=>o,users:()=>i});var a=r(3137),n=r(3161),s=r(7095);let i=(0,a.D)("users",{id:(0,n.Qq)("id").primaryKey().$defaultFn(()=>crypto.randomUUID()),email:(0,n.Qq)("email").notNull().unique(),password:(0,n.Qq)("password").notNull(),name:(0,n.Qq)("name"),createdAt:(0,s.nd)("created_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date),updatedAt:(0,s.nd)("updated_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date).$onUpdate(()=>new Date)}),o=(0,a.D)("shiurim",{id:(0,n.Qq)("id").primaryKey().$defaultFn(()=>crypto.randomUUID()),guid:(0,n.Qq)("guid").notNull().unique(),slug:(0,n.Qq)("slug").unique(),title:(0,n.Qq)("title").notNull(),description:(0,n.Qq)("description"),blurb:(0,n.Qq)("blurb"),audioUrl:(0,n.Qq)("audio_url").notNull(),sourceDoc:(0,n.Qq)("source_doc"),pubDate:(0,s.nd)("pub_date",{mode:"timestamp"}).notNull(),duration:(0,n.Qq)("duration"),link:(0,n.Qq)("link"),thumbnail:(0,n.Qq)("thumbnail"),createdAt:(0,s.nd)("created_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date),updatedAt:(0,s.nd)("updated_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date).$onUpdate(()=>new Date)}),u=(0,a.D)("platform_links",{id:(0,n.Qq)("id").primaryKey().$defaultFn(()=>crypto.randomUUID()),shiurId:(0,n.Qq)("shiur_id").notNull().unique().references(()=>o.id,{onDelete:"cascade"}),youtube:(0,n.Qq)("youtube"),youtubeMusic:(0,n.Qq)("youtube_music"),spotify:(0,n.Qq)("spotify"),apple:(0,n.Qq)("apple"),amazon:(0,n.Qq)("amazon"),pocket:(0,n.Qq)("pocket"),twentyFourSix:(0,n.Qq)("twenty_four_six"),castbox:(0,n.Qq)("castbox"),createdAt:(0,s.nd)("created_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date),updatedAt:(0,s.nd)("updated_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date).$onUpdate(()=>new Date)})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,920,452,512],()=>r(5414));module.exports=a})();