(()=>{var e={};e.id=988,e.ids=[988],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},983:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>D,routeModule:()=>w,serverHooks:()=>q,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>y});var a={};r.r(a),r.d(a,{POST:()=>g});var n=r(2706),i=r(8203),s=r(5994),u=r(9187),o=r(2545),d=r(6980),l=r(7579);async function c(e){try{let t;let r=await fetch(e);if(!r.ok)throw Error(`Failed to fetch RSS feed: ${r.statusText}`);let a=await r.text(),n=[],i=/<item>([\s\S]*?)<\/item>/gi;for(;null!==(t=i.exec(a));){let e=t[1],r=t=>{let r=RegExp(`<${t}[^>]*>([\\s\\S]*?)<\\/${t}>`,"i"),a=e.match(r);return a?a[1].replace(/<!\[CDATA\[([\s\S]*?)\]\]>/g,"$1").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").trim():""},a=e.match(/<enclosure[^>]+url="([^"]+)"/i),i=a?a[1]:r("link"),s=e.match(/<itunes:duration[^>]*>([^<]+)<\/itunes:duration>/i),u=s?s[1]:"",o={guid:r("guid")||r("link"),title:r("title"),description:r("description")||r("content:encoded"),audioUrl:i,pubDate:r("pubDate"),duration:u,link:r("link")};o.guid&&o.title&&n.push(o)}return n}catch(e){throw console.error("Error fetching RSS feed:",e),e}}async function p(e,t){let r=await c(t),a=(0,o.Lf)(e),n=[],i=[];for(let e of r)try{await a.select().from(d.shiurim).where((0,l.eq)(d.shiurim.guid,e.guid)).get()?await a.update(d.shiurim).set({title:e.title,description:e.description,audioUrl:e.audioUrl,pubDate:new Date(e.pubDate),duration:e.duration,link:e.link,updatedAt:new Date}).where((0,l.eq)(d.shiurim.guid,e.guid)).execute():await a.insert(d.shiurim).values({guid:e.guid,title:e.title,description:e.description,audioUrl:e.audioUrl,pubDate:new Date(e.pubDate),duration:e.duration,link:e.link}).execute(),n.push(e.guid)}catch(t){console.error(`Error syncing item ${e.guid}:`,t),i.push(e.guid)}return{synced:n,errors:i,total:r.length}}var m=r(4512);async function f(e){let t=(await (0,m.UL)()).get("admin-session");if(!t)return!1;let r=(0,o.Lf)(e);return!!await r.select().from(d.users).where((0,l.eq)(d.users.id,t.value)).get()}async function g(e){try{let t=await (0,o.x8)();if(!t)return u.NextResponse.json({error:"Database not configured"},{status:500});if(!await f(t))return u.NextResponse.json({error:"Unauthorized"},{status:401});let{feedUrl:r}=await e.json(),a=r||process.env.RSS_FEED_URL;if(!a)return u.NextResponse.json({error:"RSS feed URL is required"},{status:400});let n=await p(t,a);return u.NextResponse.json({success:!0,synced:n.synced.length,errors:n.errors.length,total:n.total})}catch(e){return console.error("Error syncing RSS feed:",e),u.NextResponse.json({error:"Internal server error"},{status:500})}}let w=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/rss/sync/route",pathname:"/api/rss/sync",filename:"route",bundlePath:"app/api/rss/sync/route"},resolvedPagePath:"C:\\Users\\alk77\\Downloads\\krazywaz-master\\krazywaz-master\\Downloads\\krazywaz\\krazzzzz\\app\\api\\rss\\sync\\route.ts",nextConfigOutput:"standalone",userland:a}),{workAsyncStorage:h,workUnitAsyncStorage:y,serverHooks:q}=w;function D(){return(0,s.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:y})}},6487:()=>{},8335:()=>{},2545:(e,t,r)=>{"use strict";r.d(t,{Lf:()=>i,x8:()=>s});var a=r(1205),n=r(6980);function i(e){return(0,a.f)(e,{schema:n})}async function s(){try{let{getCloudflareContext:e}=await r.e(535).then(r.bind(r,6535)),t=await e(),a=t?.env;if(a?.DB)return a.DB}catch(e){}return globalThis.DB?globalThis.DB:null}},6980:(e,t,r)=>{"use strict";r.r(t),r.d(t,{platformLinks:()=>o,shiurim:()=>u,users:()=>s});var a=r(3137),n=r(3161),i=r(7095);let s=(0,a.D)("users",{id:(0,n.Qq)("id").primaryKey().$defaultFn(()=>crypto.randomUUID()),email:(0,n.Qq)("email").notNull().unique(),password:(0,n.Qq)("password").notNull(),name:(0,n.Qq)("name"),createdAt:(0,i.nd)("created_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date),updatedAt:(0,i.nd)("updated_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date).$onUpdate(()=>new Date)}),u=(0,a.D)("shiurim",{id:(0,n.Qq)("id").primaryKey().$defaultFn(()=>crypto.randomUUID()),guid:(0,n.Qq)("guid").notNull().unique(),slug:(0,n.Qq)("slug").unique(),title:(0,n.Qq)("title").notNull(),description:(0,n.Qq)("description"),blurb:(0,n.Qq)("blurb"),audioUrl:(0,n.Qq)("audio_url").notNull(),sourceDoc:(0,n.Qq)("source_doc"),pubDate:(0,i.nd)("pub_date",{mode:"timestamp"}).notNull(),duration:(0,n.Qq)("duration"),link:(0,n.Qq)("link"),thumbnail:(0,n.Qq)("thumbnail"),createdAt:(0,i.nd)("created_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date),updatedAt:(0,i.nd)("updated_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date).$onUpdate(()=>new Date)}),o=(0,a.D)("platform_links",{id:(0,n.Qq)("id").primaryKey().$defaultFn(()=>crypto.randomUUID()),shiurId:(0,n.Qq)("shiur_id").notNull().unique().references(()=>u.id,{onDelete:"cascade"}),youtube:(0,n.Qq)("youtube"),youtubeMusic:(0,n.Qq)("youtube_music"),spotify:(0,n.Qq)("spotify"),apple:(0,n.Qq)("apple"),amazon:(0,n.Qq)("amazon"),pocket:(0,n.Qq)("pocket"),twentyFourSix:(0,n.Qq)("twenty_four_six"),castbox:(0,n.Qq)("castbox"),createdAt:(0,i.nd)("created_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date),updatedAt:(0,i.nd)("updated_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date).$onUpdate(()=>new Date)})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,920,452,512],()=>r(983));module.exports=a})();